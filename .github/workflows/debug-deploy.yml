name: Debug Railway Deploy

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check secrets availability
        run: |
          if [ -n "${{ secrets.RAILWAY_TOKEN }}" ]; then
            echo "RAILWAY_TOKEN is set"
          else
            echo "RAILWAY_TOKEN is NOT set"
          fi
          if [ -n "${{ secrets.CURSEFORGE_API_KEY }}" ]; then
            echo "CURSEFORGE_API_KEY is set"
          else
            echo "CURSEFORGE_API_KEY is NOT set"
          fi

      - name: Install Railway CLI
        run: npm install -g @railway/cli

      - name: Try Railway login
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          railway whoami || echo "Not logged in"
          railway status || echo "Status failed"

      - name: Try to set variable via Railway API
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
          CURSEFORGE_API_KEY: ${{ secrets.CURSEFORGE_API_KEY }}
        run: |
          # Try using railway CLI with project flag
          echo "Attempting to link project..."
          mkdir -p .railway
          echo '{"projectId": "a18c5404-6b6a-4d09-936f-e90d391a5a2d"}' > .railway/config.json
          
          echo "Setting environment variable..."
          railway variables set CURSEFORGE_API_KEY="$CURSEFORGE_API_KEY" || echo "Failed to set variable"
          
          echo "Deploying..."
          railway up || echo "Deploy may have issues"
